import{e as L}from"./chunk-SF7C3E5M.js";import{$ as f,W as m}from"./chunk-AG6NMNX5.js";import{a as D,b as w,j as g}from"./chunk-TWZW5B45.js";var y=class l{debugLogger=f(L);db=null;dbReady;constructor(){this.dbReady=Promise.resolve()}initDB(){return g(this,null,function*(){return new Promise((e,t)=>{this.debugLogger.info(this.logCategory,`\u{1F527} ${this.dbName} \uCD08\uAE30\uD654 \uC2DC\uC791...`);let r=indexedDB.open(this.dbName,this.version);r.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C DB \uC5F4\uAE30 \uC2E4\uD328: ${r.error}`),this.db=null,t(r.error)},r.onsuccess=()=>{this.db=r.result,this.db.onclose=()=>{this.debugLogger.warn(this.logCategory,"\u26A0\uFE0F DB \uC5F0\uACB0\uC774 \uB2EB\uD798"),this.db=null},this.db.onerror=c=>{this.debugLogger.error(this.logCategory,`\u274C DB \uC624\uB958: ${c}`)},this.debugLogger.success(this.logCategory,`\u2705 ${this.dbName} \uCD08\uAE30\uD654 \uC131\uACF5`),e()},r.onupgradeneeded=c=>{this.debugLogger.info(this.logCategory,`\u2B06\uFE0F ${this.dbName} \uC5C5\uADF8\uB808\uC774\uB4DC \uC911...`);let a=c.target.result,s=c.target.transaction;this.createObjectStore(a,s),this.debugLogger.success(this.logCategory,`\u2705 ${this.dbName} \uC5C5\uADF8\uB808\uC774\uB4DC \uC644\uB8CC`)}})})}ensureDB(){return g(this,null,function*(){if(yield this.dbReady,this.db&&!this.db.objectStoreNames.length&&(this.db=null),this.db||(yield this.initDB()),!this.db)throw new Error(`${this.dbName} \uC5F0\uACB0 \uC2E4\uD328`);return this.db})}transaction(e,t){return g(this,null,function*(){let r=yield this.ensureDB();return new Promise((c,a)=>{let s=r.transaction([this.storeName],e),n=s.objectStore(this.storeName),o=t(n);o.onsuccess=()=>{c(o.result)},o.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uD2B8\uB79C\uC7AD\uC158 \uC624\uB958: ${o.error}`),a(o.error)},s.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uD2B8\uB79C\uC7AD\uC158 \uC2E4\uD328: ${s.error}`),a(s.error)}})})}save(e){return g(this,null,function*(){try{yield this.transaction("readwrite",t=>t.put(e)),this.debugLogger.success(this.logCategory,"\u{1F4BE} \uB370\uC774\uD130 \uC800\uC7A5 \uC644\uB8CC")}catch(t){throw this.debugLogger.error(this.logCategory,`\u274C \uB370\uC774\uD130 \uC800\uC7A5 \uC2E4\uD328: ${t}`),t}})}getById(e){return g(this,null,function*(){try{return(yield this.transaction("readonly",r=>r.get(e)))||null}catch(t){return this.debugLogger.error(this.logCategory,`\u274C \uB370\uC774\uD130 \uC870\uD68C \uC2E4\uD328: ${t}`),null}})}getAll(){return g(this,null,function*(){try{let e=yield this.transaction("readonly",t=>t.getAll());return this.debugLogger.info(this.logCategory,`\u{1F4CB} \uB370\uC774\uD130 \uBAA9\uB85D \uC870\uD68C \uC644\uB8CC: ${e.length}\uAC1C`),e}catch(e){return this.debugLogger.error(this.logCategory,`\u274C \uB370\uC774\uD130 \uBAA9\uB85D \uC870\uD68C \uC2E4\uD328: ${e}`),[]}})}delete(e){return g(this,null,function*(){try{yield this.transaction("readwrite",t=>t.delete(e)),this.debugLogger.success(this.logCategory,`\u{1F5D1}\uFE0F \uB370\uC774\uD130 \uC0AD\uC81C \uC644\uB8CC: ${e}`)}catch(t){throw this.debugLogger.error(this.logCategory,`\u274C \uB370\uC774\uD130 \uC0AD\uC81C \uC2E4\uD328: ${t}`),t}})}clear(){return g(this,null,function*(){try{yield this.transaction("readwrite",e=>e.clear()),this.debugLogger.success(this.logCategory,"\u{1F9F9} \uBAA8\uB4E0 \uB370\uC774\uD130 \uC0AD\uC81C \uC644\uB8CC")}catch(e){throw this.debugLogger.error(this.logCategory,`\u274C \uB370\uC774\uD130 \uC0AD\uC81C \uC2E4\uD328: ${e}`),e}})}count(){return g(this,null,function*(){try{return yield this.transaction("readonly",t=>t.count())}catch(e){return this.debugLogger.error(this.logCategory,`\u274C \uB370\uC774\uD130 \uAC1C\uC218 \uC870\uD68C \uC2E4\uD328: ${e}`),0}})}getByIndex(e,t){return g(this,null,function*(){try{let r=yield this.ensureDB();return new Promise((c,a)=>{let i=r.transaction([this.storeName],"readonly").objectStore(this.storeName).index(e).getAll(t);i.onsuccess=()=>{c(i.result)},i.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uC778\uB371\uC2A4 \uC870\uD68C \uC2E4\uD328: ${i.error}`),a(i.error)}})}catch(r){return this.debugLogger.error(this.logCategory,`\u274C \uC778\uB371\uC2A4 \uC870\uD68C \uC911 \uC624\uB958: ${r}`),[]}})}forEach(e,t="next"){return g(this,null,function*(){try{let r=yield this.ensureDB();return new Promise((c,a)=>{let o=r.transaction([this.storeName],"readonly").objectStore(this.storeName).openCursor(null,t);o.onsuccess=()=>g(this,null,function*(){let i=o.result;i?(yield e(i.value),i.continue()):c()}),o.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uCEE4\uC11C \uC21C\uD68C \uC2E4\uD328: ${o.error}`),a(o.error)}})}catch(r){throw this.debugLogger.error(this.logCategory,`\u274C \uCEE4\uC11C \uC21C\uD68C \uC911 \uC624\uB958: ${r}`),r}})}closeConnection(){this.db&&(this.db.close(),this.db=null,this.debugLogger.info(this.logCategory,`\u{1F50C} ${this.dbName} \uC5F0\uACB0 \uC885\uB8CC`))}resetDatabase(){return g(this,null,function*(){return new Promise((e,t)=>{this.closeConnection();let r=indexedDB.deleteDatabase(this.dbName);r.onsuccess=()=>{this.debugLogger.success(this.logCategory,`\u2705 ${this.dbName} \uC0AD\uC81C \uC644\uB8CC`),this.dbReady=this.initDB(),this.dbReady.then(()=>{this.debugLogger.success(this.logCategory,`\u2705 ${this.dbName} \uC7AC\uC0DD\uC131 \uC644\uB8CC`),e()}).catch(t)},r.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C ${this.dbName} \uC0AD\uC81C \uC2E4\uD328: ${r.error}`),t(r.error)},r.onblocked=()=>{this.debugLogger.warn(this.logCategory,`\u26A0\uFE0F ${this.dbName} \uC0AD\uC81C\uAC00 \uCC28\uB2E8\uB428 - \uB2E4\uB978 \uD0ED\uC5D0\uC11C \uC0AC\uC6A9 \uC911\uC77C \uC218 \uC788\uC2B5\uB2C8\uB2E4.`)}})})}static \u0275fac=function(t){return new(t||l)};static \u0275prov=m({token:l,factory:l.\u0275fac})};var $=class l extends y{dbName="EzReaderDB";storeName="documents";version=5;logCategory="IndexedDB-Document";constructor(){super(),this.dbReady=this.initDB()}createObjectStore(e,t){if(e.objectStoreNames.contains("documents")){if(t){let r=t.objectStore("documents");r&&!r.indexNames.contains("folderId")&&(r.createIndex("folderId","folderId",{unique:!1}),this.debugLogger.info("IndexedDB-Init","\u{1F4E6} documents \uC800\uC7A5\uC18C\uC5D0 folderId \uC778\uB371\uC2A4 \uCD94\uAC00\uB428"))}}else{let r=e.createObjectStore("documents",{keyPath:"id"});r.createIndex("title","title",{unique:!1}),r.createIndex("createdAt","createdAt",{unique:!1}),r.createIndex("updatedAt","updatedAt",{unique:!1}),r.createIndex("folderId","folderId",{unique:!1}),this.debugLogger.info("IndexedDB-Init","\u{1F4E6} documents \uC800\uC7A5\uC18C \uC0DD\uC131\uB428")}if(!e.objectStoreNames.contains("folders")){let r=e.createObjectStore("folders",{keyPath:"id"});r.createIndex("name","name",{unique:!1}),r.createIndex("parentId","parentId",{unique:!1}),r.createIndex("order","order",{unique:!1}),r.createIndex("createdAt","createdAt",{unique:!1}),this.debugLogger.info("IndexedDB-Init","\u{1F4E6} folders \uC800\uC7A5\uC18C \uC0DD\uC131\uB428")}if(!e.objectStoreNames.contains("recentFiles")){let r=e.createObjectStore("recentFiles",{keyPath:"id"});r.createIndex("documentId","documentId",{unique:!1}),r.createIndex("viewedAt","viewedAt",{unique:!1}),r.createIndex("createdAt","createdAt",{unique:!1}),this.debugLogger.info("IndexedDB-Init","\u{1F4E6} recentFiles \uC800\uC7A5\uC18C \uC0DD\uC131\uB428")}e.objectStoreNames.contains("settings")||(e.createObjectStore("settings",{keyPath:"key"}),this.debugLogger.info("IndexedDB-Init","\u{1F4E6} settings \uC800\uC7A5\uC18C \uC0DD\uC131\uB428"))}saveDocument(e){return g(this,null,function*(){try{let r=(yield this.ensureDB()).transaction([this.storeName],"readwrite"),c=r.objectStore(this.storeName);return new Promise((a,s)=>{r.oncomplete=()=>{this.debugLogger.success(this.logCategory,`\u{1F4BE} \uBB38\uC11C \uC800\uC7A5 \uC644\uB8CC: ${e.title}`),a()},r.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uD2B8\uB79C\uC7AD\uC158 \uC624\uB958: ${r.error}`),s(r.error)};let n=c.get(e.id);n.onsuccess=()=>{let o=n.result;if(o)e.createdAt=o.createdAt,e.updatedAt=new Date().toISOString();else{let i=new Date().toISOString();e.createdAt=i,e.updatedAt=i}c.put(e)},n.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uAE30\uC874 \uBB38\uC11C \uC870\uD68C \uC2E4\uD328: ${n.error}`),s(n.error)}})}catch(t){throw this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC800\uC7A5 \uC911 \uC624\uB958: ${t}`),t}})}getAllDocuments(){return g(this,null,function*(){try{let c=(yield this.ensureDB()).transaction([this.storeName],"readonly").objectStore(this.storeName).index("updatedAt");return new Promise((a,s)=>{let n=c.openCursor(null,"prev"),o=[];n.onsuccess=()=>{let i=n.result;i?(o.push(i.value),i.continue()):(this.debugLogger.info(this.logCategory,`\u{1F4C4} \uBB38\uC11C \uBAA9\uB85D \uC870\uD68C \uC644\uB8CC: ${o.length}\uAC1C`),a(o))},n.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uBAA9\uB85D \uC870\uD68C \uC2E4\uD328: ${n.error}`),s(n.error)}})}catch(e){return this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uBAA9\uB85D \uC870\uD68C \uC911 \uC624\uB958: ${e}`),[]}})}getDocumentById(e){return g(this,null,function*(){try{return yield this.getById(e)}catch(t){return this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC870\uD68C \uC911 \uC624\uB958: ${t}`),null}})}getDocumentByTitle(e){return g(this,null,function*(){try{let a=(yield this.ensureDB()).transaction([this.storeName],"readonly").objectStore(this.storeName).index("title");return new Promise((s,n)=>{let o=a.get(e);o.onsuccess=()=>{s(o.result||null)},o.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC870\uD68C \uC2E4\uD328: ${o.error}`),n(o.error)}})}catch(t){return this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC870\uD68C \uC911 \uC624\uB958: ${t}`),null}})}updateDocument(e){return g(this,null,function*(){try{e.updatedAt=new Date().toISOString();let c=(yield this.ensureDB()).transaction([this.storeName],"readwrite").objectStore(this.storeName);return new Promise((a,s)=>{let n=c.put(e);n.onsuccess=()=>{this.debugLogger.success(this.logCategory,`\u270F\uFE0F \uBB38\uC11C \uC5C5\uB370\uC774\uD2B8 \uC644\uB8CC: ${e.title}`),a()},n.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC5C5\uB370\uC774\uD2B8 \uC2E4\uD328: ${n.error}`),s(n.error)}})}catch(t){throw this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC5C5\uB370\uC774\uD2B8 \uC911 \uC624\uB958: ${t}`),t}})}deleteDocument(e){return g(this,null,function*(){try{yield this.delete(e),this.debugLogger.success(this.logCategory,`\u{1F5D1}\uFE0F \uBB38\uC11C \uC0AD\uC81C \uC131\uACF5: ${e}`)}catch(t){throw this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC0AD\uC81C \uC911 \uC624\uB958: ${t}`),t}})}searchDocumentsByTitle(e){return g(this,null,function*(){try{let a=(yield this.ensureDB()).transaction([this.storeName],"readonly").objectStore(this.storeName).index("title");return new Promise((s,n)=>{let o=a.openCursor(IDBKeyRange.bound(e,e+"\uFFFF")),i=[];o.onsuccess=()=>{let d=o.result;d?(d.value.title.toLowerCase().includes(e.toLowerCase())&&i.push(d.value),d.continue()):s(i)},o.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uAC80\uC0C9 \uC2E4\uD328: ${o.error}`),n(o.error)}})}catch(t){return this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uAC80\uC0C9 \uC911 \uC624\uB958: ${t}`),[]}})}getRecentDocuments(e=30){return g(this,null,function*(){try{return(yield this.getAllDocuments()).slice(0,e)}catch(t){return this.debugLogger.error(this.logCategory,`\u274C \uCD5C\uADFC \uBB38\uC11C \uC870\uD68C \uC911 \uC624\uB958: ${t}`),[]}})}getStorageUsage(){return g(this,null,function*(){try{if("storage"in navigator&&"estimate"in navigator.storage){let e=yield navigator.storage.estimate();return{used:e.usage||0,quota:e.quota||0}}return{used:0,quota:0}}catch(e){return this.debugLogger.error(this.logCategory,`\u274C \uC2A4\uD1A0\uB9AC\uC9C0 \uC0AC\uC6A9\uB7C9 \uD655\uC778 \uC2E4\uD328: ${e}`),{used:0,quota:0}}})}cleanupOldDocuments(e=20){return g(this,null,function*(){try{let t=yield this.getAllDocuments();if(t.length>e){let r=t.slice(e);for(let c of r)yield this.deleteDocument(c.id);this.debugLogger.info(this.logCategory,`\u{1F9F9} \uC624\uB798\uB41C \uBB38\uC11C ${r.length}\uAC1C \uC0AD\uC81C \uC644\uB8CC`)}}catch(t){this.debugLogger.error(this.logCategory,`\u274C \uB370\uC774\uD130\uBCA0\uC774\uC2A4 \uC815\uB9AC \uC911 \uC624\uB958: ${t}`)}})}migrateFromLocalStorage(){return g(this,null,function*(){try{let e=localStorage.getItem("savedDocuments");if(e){let t=JSON.parse(e);this.debugLogger.info("IndexedDB-Migration",`\u{1F504} \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC2DC\uC791: ${t.length}\uAC1C \uBB38\uC11C`);let r=0,c=0,a=5;for(let s=0;s<t.length;s+=a){let n=t.slice(s,s+a);for(let o of n)try{yield this.saveDocument(o),r++,this.debugLogger.success("IndexedDB-Migration",`\u2705 \uBB38\uC11C \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC131\uACF5: ${o.title} (${r}/${t.length})`)}catch(i){c++,this.debugLogger.error("IndexedDB-Migration",`\u274C \uAC1C\uBCC4 \uBB38\uC11C \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC2E4\uD328: ${o.title} - ${i}`)}s+a<t.length&&(yield new Promise(o=>setTimeout(o,10)))}this.debugLogger.info("IndexedDB-Migration",`\u{1F4CA} \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC644\uB8CC: \uC131\uACF5 ${r}\uAC1C, \uC2E4\uD328 ${c}\uAC1C`),r>0&&(localStorage.removeItem("savedDocuments"),this.debugLogger.info("IndexedDB-Migration","\u{1F9F9} localStorage \uC815\uB9AC \uC644\uB8CC"))}else this.debugLogger.info("IndexedDB-Migration","\u2139\uFE0F \uB9C8\uC774\uADF8\uB808\uC774\uC158\uD560 localStorage \uB370\uC774\uD130 \uC5C6\uC74C")}catch(e){throw this.debugLogger.error("IndexedDB-Migration",`\u274C \uB9C8\uC774\uADF8\uB808\uC774\uC158 \uC911 \uC624\uB958: ${e}`),e}})}createFolder(e,t=null){return g(this,null,function*(){try{let r=yield this.ensureDB(),c=yield this.getFolders(t);this.debugLogger.info(this.logCategory,`\u{1F4CA} \uAE30\uC874 \uD3F4\uB354 \uAC1C\uC218: ${c.length}`);let a=c.length>0?Math.max(...c.map(i=>i.order)):0,s={id:this.generateId(),name:e,parentId:t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),order:a+1};console.log("\u{1F4C1} \uD3F4\uB354 \uC0DD\uC131 \uC2DC\uB3C4:",s);let o=r.transaction(["folders"],"readwrite").objectStore("folders");return new Promise((i,d)=>{let u=o.add(s);u.onsuccess=()=>g(this,null,function*(){console.log("\u{1F7E2} \uD3F4\uB354 \uC800\uC7A5 \uC131\uACF5! id:",s.id),this.debugLogger.success(this.logCategory,`\u2705 \uD3F4\uB354 \uC800\uC7A5 \uC644\uB8CC: ${e}, id: ${s.id}`);let h=o.get(s.id);h.onsuccess=()=>{console.log("\u{1F50D} \uC800\uC7A5\uB41C \uD3F4\uB354 \uD655\uC778:",h.result),console.log("\u{1F50D} \uC800\uC7A5 \uD655\uC778 \uCD94\uAC00 \uB85C\uADF8:",h.result)},i(s)}),u.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uC0DD\uC131 \uC2E4\uD328: ${u.error}`),d(u.error)}})}catch(r){throw this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uC0DD\uC131 \uC911 \uC624\uB958: ${r}`),r}})}updateFolder(e,t){return g(this,null,function*(){try{let a=(yield this.ensureDB()).transaction(["folders"],"readwrite").objectStore("folders");return new Promise((s,n)=>{let o=a.get(e);o.onsuccess=()=>{let i=o.result;if(!i){n(new Error("\uD3F4\uB354\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."));return}i.name=t,i.updatedAt=new Date().toISOString();let d=a.put(i);d.onsuccess=()=>{this.debugLogger.success(this.logCategory,`\u{1F4DD} \uD3F4\uB354 \uC218\uC815 \uC644\uB8CC: ${t}`),s()},d.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uC218\uC815 \uC2E4\uD328: ${d.error}`),n(d.error)}},o.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uC870\uD68C \uC2E4\uD328: ${o.error}`),n(o.error)}})}catch(r){throw this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uC218\uC815 \uC911 \uC624\uB958: ${r}`),r}})}deleteFolder(e){return g(this,null,function*(){try{let r=(yield this.ensureDB()).transaction(["folders","documents"],"readwrite"),c=r.objectStore("folders"),a=r.objectStore("documents");return new Promise((s,n)=>{r.oncomplete=()=>{this.debugLogger.success(this.logCategory,`\u{1F5D1}\uFE0F \uD3F4\uB354 \uC0AD\uC81C \uC644\uB8CC: ${e}`),s()},r.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uC0AD\uC81C \uD2B8\uB79C\uC7AD\uC158 \uC624\uB958: ${r.error}`),n(r.error)};let o=a.getAll();o.onsuccess=()=>{o.result.filter(u=>u.folderId===e).forEach(u=>{u.folderId=null,u.updatedAt=new Date().toISOString(),a.put(u)}),c.delete(e)},o.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC870\uD68C \uC624\uB958: ${o.error}`),n(o.error)}})}catch(t){throw this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uC0AD\uC81C \uC911 \uC624\uB958: ${t}`),t}})}getFolders(e=null){return g(this,null,function*(){try{console.log("\u{1F535} getFolders \uD638\uCD9C\uB428, parentId:",e);let c=(yield this.ensureDB()).transaction(["folders"],"readonly").objectStore("folders");return new Promise((a,s)=>{let n=c.getAll();n.onsuccess=()=>{let o=n.result;console.log("\u{1F7E2} \uC804\uCCB4 \uD3F4\uB354 \uC870\uD68C \uC131\uACF5:",o.length,o);let i=o.filter(d=>(console.log(`  - \uD3F4\uB354 "${d.name}" parentId: ${d.parentId} (\uD0C0\uC785: ${typeof d.parentId}), \uBE44\uAD50\uB300\uC0C1: ${e} (\uD0C0\uC785: ${typeof e})`),d.parentId===e));i.sort((d,u)=>d.order-u.order),console.log("\u{1F7E1} \uD544\uD130\uB9C1 \uC644\uB8CC:",i.length,i),this.debugLogger.info(this.logCategory,`\u{1F4C2} \uD544\uD130\uB9C1\uB41C \uD3F4\uB354 (parentId=${e}): ${i.length}\uAC1C`),a(i)},n.onerror=()=>{console.error("\u{1F534} \uD3F4\uB354 \uC870\uD68C \uC2E4\uD328:",n.error),this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uBAA9\uB85D \uC870\uD68C \uC2E4\uD328: ${n.error}`),s(n.error)}})}catch(t){return console.error("\u{1F534} getFolders \uC624\uB958:",t),this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uBAA9\uB85D \uC870\uD68C \uC911 \uC624\uB958: ${t}`),[]}})}getFolderById(e){return g(this,null,function*(){try{let c=(yield this.ensureDB()).transaction(["folders"],"readonly").objectStore("folders");return new Promise((a,s)=>{let n=c.get(e);n.onsuccess=()=>{a(n.result||null)},n.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uC870\uD68C \uC2E4\uD328: ${n.error}`),s(n.error)}})}catch(t){return this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uC870\uD68C \uC911 \uC624\uB958: ${t}`),null}})}moveDocumentToFolder(e,t){return g(this,null,function*(){try{let a=(yield this.ensureDB()).transaction(["documents"],"readwrite").objectStore("documents");return new Promise((s,n)=>{let o=a.get(e);o.onsuccess=()=>{let i=o.result;if(!i){n(new Error("\uBB38\uC11C\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."));return}i.folderId=t,i.updatedAt=new Date().toISOString();let d=a.put(i);d.onsuccess=()=>{this.debugLogger.success(this.logCategory,`\u{1F4E6} \uBB38\uC11C \uC774\uB3D9 \uC644\uB8CC: ${i.title}`),s()},d.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC774\uB3D9 \uC2E4\uD328: ${d.error}`),n(d.error)}},o.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC870\uD68C \uC2E4\uD328: ${o.error}`),n(o.error)}})}catch(r){throw this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC774\uB3D9 \uC911 \uC624\uB958: ${r}`),r}})}getFolderContents(e){return g(this,null,function*(){try{let c=(yield this.ensureDB()).transaction(["documents"],"readonly").objectStore("documents");return new Promise((a,s)=>{let n=c.getAll();n.onsuccess=()=>{let o=n.result,i=o.filter(d=>d.folderId===e);i.sort((d,u)=>new Date(u.updatedAt).getTime()-new Date(d.updatedAt).getTime()),this.debugLogger.info(this.logCategory,`\u{1F4C4} \uD3F4\uB354 \uB0B4\uC6A9 \uC870\uD68C \uC644\uB8CC: ${i.length}\uAC1C (\uC804\uCCB4: ${o.length}\uAC1C)`),a(i)},n.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uB0B4\uC6A9 \uC870\uD68C \uC2E4\uD328: ${n.error}`),s(n.error)}})}catch(t){return this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uB0B4\uC6A9 \uC870\uD68C \uC911 \uC624\uB958: ${t}`),[]}})}getFolderDocumentCount(e){return g(this,null,function*(){try{return(yield this.getFolderContents(e)).length}catch(t){return this.debugLogger.error(this.logCategory,`\u274C \uD3F4\uB354 \uBB38\uC11C \uAC1C\uC218 \uC870\uD68C \uC911 \uC624\uB958: ${t}`),0}})}toggleFavorite(e){return g(this,null,function*(){try{let c=(yield this.ensureDB()).transaction(["documents"],"readwrite").objectStore("documents");return new Promise((a,s)=>{let n=c.get(e);n.onsuccess=()=>{let o=n.result;if(!o){s(new Error("\uBB38\uC11C\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."));return}o.isFavorite=!o.isFavorite,o.updatedAt=new Date().toISOString();let i=c.put(o);i.onsuccess=()=>{this.debugLogger.success(this.logCategory,`\u2B50 \uC990\uACA8\uCC3E\uAE30 ${o.isFavorite?"\uCD94\uAC00":"\uC81C\uAC70"}: ${o.title}`),a()},i.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uC990\uACA8\uCC3E\uAE30 \uD1A0\uAE00 \uC2E4\uD328: ${i.error}`),s(i.error)}},n.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uBB38\uC11C \uC870\uD68C \uC2E4\uD328: ${n.error}`),s(n.error)}})}catch(t){throw this.debugLogger.error(this.logCategory,`\u274C \uC990\uACA8\uCC3E\uAE30 \uD1A0\uAE00 \uC911 \uC624\uB958: ${t}`),t}})}getFavoriteDocuments(){return g(this,null,function*(){try{let r=(yield this.ensureDB()).transaction(["documents"],"readonly").objectStore("documents");return new Promise((c,a)=>{let s=r.getAll();s.onsuccess=()=>{let o=s.result.filter(i=>i.isFavorite===!0);o.sort((i,d)=>new Date(d.updatedAt).getTime()-new Date(i.updatedAt).getTime()),this.debugLogger.info(this.logCategory,`\u2B50 \uC990\uACA8\uCC3E\uAE30 \uBB38\uC11C \uC870\uD68C \uC644\uB8CC: ${o.length}\uAC1C`),c(o)},s.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uC990\uACA8\uCC3E\uAE30 \uBB38\uC11C \uC870\uD68C \uC2E4\uD328: ${s.error}`),a(s.error)}})}catch(e){return this.debugLogger.error(this.logCategory,`\u274C \uC990\uACA8\uCC3E\uAE30 \uBB38\uC11C \uC870\uD68C \uC911 \uC624\uB958: ${e}`),[]}})}getResultDocuments(){return g(this,null,function*(){try{let r=(yield this.ensureDB()).transaction(["documents"],"readonly").objectStore("documents");return new Promise((c,a)=>{let s=r.getAll();s.onsuccess=()=>{let o=s.result.filter(i=>i.folderId==="results");o.sort((i,d)=>new Date(d.updatedAt).getTime()-new Date(i.updatedAt).getTime()),this.debugLogger.info(this.logCategory,`\u{1F4CA} \uACB0\uACFC\uBB3C \uBB38\uC11C \uC870\uD68C \uC644\uB8CC: ${o.length}\uAC1C`),c(o)},s.onerror=()=>{this.debugLogger.error(this.logCategory,`\u274C \uACB0\uACFC\uBB3C \uBB38\uC11C \uC870\uD68C \uC2E4\uD328: ${s.error}`),a(s.error)}})}catch(e){return this.debugLogger.error(this.logCategory,`\u274C \uACB0\uACFC\uBB3C \uBB38\uC11C \uC870\uD68C \uC911 \uC624\uB958: ${e}`),[]}})}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}addToRecentFiles(e,t,r,c,a){return g(this,null,function*(){try{let s=yield this.ensureDB();if(!s.objectStoreNames.contains("recentFiles"))return this.debugLogger.warn("IndexedDB-RecentFiles","\u26A0\uFE0F recentFiles \uC800\uC7A5\uC18C \uC5C6\uC74C - DB \uC7AC\uCD08\uAE30\uD654 \uD544\uC694"),s.close(),this.db=null,yield this.initDB(),this.addToRecentFiles(e,t,r,c,a);let n=yield this.getRecentFileByDocumentId(e),o=new Date().toISOString(),i=n?w(D({},n),{fileName:t,thumbnail:r,documentType:c,folderId:a,viewedAt:o}):{id:this.generateId(),documentId:e,fileName:t,thumbnail:r,documentType:c,folderId:a,viewedAt:o,createdAt:o},u=s.transaction(["recentFiles"],"readwrite").objectStore("recentFiles");return new Promise((h,C)=>{let b=u.put(i);b.onsuccess=()=>{this.debugLogger.success("IndexedDB-RecentFiles",`\u{1F4CC} \uCD5C\uADFC \uBCF8 \uD30C\uC77C\uC5D0 \uCD94\uAC00: ${t}`),h()},b.onerror=()=>{this.debugLogger.error("IndexedDB-RecentFiles",`\u274C \uCD5C\uADFC \uD30C\uC77C \uCD94\uAC00 \uC2E4\uD328: ${b.error}`),C(b.error)}})}catch(s){throw this.debugLogger.error("IndexedDB-RecentFiles",`\u274C \uCD5C\uADFC \uD30C\uC77C \uCD94\uAC00 \uC911 \uC624\uB958: ${s}`),s}})}getRecentFileByDocumentId(e){return g(this,null,function*(){try{let a=(yield this.ensureDB()).transaction(["recentFiles"],"readonly").objectStore("recentFiles").index("documentId");return new Promise((s,n)=>{let o=a.get(e);o.onsuccess=()=>{s(o.result||null)},o.onerror=()=>{n(o.error)}})}catch{return null}})}getRecentFileEntries(e=30){return g(this,null,function*(){try{let t=yield this.ensureDB();if(!t.objectStoreNames.contains("recentFiles"))return this.debugLogger.warn("IndexedDB-RecentFiles","\u26A0\uFE0F recentFiles \uC800\uC7A5\uC18C \uC5C6\uC74C - \uBE48 \uBAA9\uB85D \uBC18\uD658"),[];let a=t.transaction(["recentFiles"],"readonly").objectStore("recentFiles").index("viewedAt");return new Promise((s,n)=>{let o=a.openCursor(null,"prev"),i=[];o.onsuccess=()=>{let d=o.result;d&&i.length<e?(i.push(d.value),d.continue()):(this.debugLogger.info("IndexedDB-RecentFiles",`\u{1F4CB} \uCD5C\uADFC \uBCF8 \uD30C\uC77C \uC870\uD68C \uC644\uB8CC: ${i.length}\uAC1C`),s(i))},o.onerror=()=>{this.debugLogger.error("IndexedDB-RecentFiles",`\u274C \uCD5C\uADFC \uD30C\uC77C \uC870\uD68C \uC2E4\uD328: ${o.error}`),n(o.error)}})}catch(t){return this.debugLogger.error("IndexedDB-RecentFiles",`\u274C \uCD5C\uADFC \uD30C\uC77C \uC870\uD68C \uC911 \uC624\uB958: ${t}`),[]}})}removeFromRecentFiles(e){return g(this,null,function*(){try{let c=(yield this.ensureDB()).transaction(["recentFiles"],"readwrite").objectStore("recentFiles");return new Promise((a,s)=>{let n=c.delete(e);n.onsuccess=()=>{this.debugLogger.success("IndexedDB-RecentFiles","\u{1F5D1}\uFE0F \uCD5C\uADFC \uD30C\uC77C\uC5D0\uC11C \uC81C\uAC70 \uC644\uB8CC"),a()},n.onerror=()=>{this.debugLogger.error("IndexedDB-RecentFiles",`\u274C \uCD5C\uADFC \uD30C\uC77C \uC81C\uAC70 \uC2E4\uD328: ${n.error}`),s(n.error)}})}catch(t){throw this.debugLogger.error("IndexedDB-RecentFiles",`\u274C \uCD5C\uADFC \uD30C\uC77C \uC81C\uAC70 \uC911 \uC624\uB958: ${t}`),t}})}clearRecentFiles(){return g(this,null,function*(){try{let r=(yield this.ensureDB()).transaction(["recentFiles"],"readwrite").objectStore("recentFiles");return new Promise((c,a)=>{let s=r.clear();s.onsuccess=()=>{this.debugLogger.success("IndexedDB-RecentFiles","\u{1F5D1}\uFE0F \uCD5C\uADFC \uD30C\uC77C \uC804\uCCB4 \uC0AD\uC81C \uC644\uB8CC"),c()},s.onerror=()=>{this.debugLogger.error("IndexedDB-RecentFiles",`\u274C \uCD5C\uADFC \uD30C\uC77C \uC804\uCCB4 \uC0AD\uC81C \uC2E4\uD328: ${s.error}`),a(s.error)}})}catch(e){throw this.debugLogger.error("IndexedDB-RecentFiles",`\u274C \uCD5C\uADFC \uD30C\uC77C \uC804\uCCB4 \uC0AD\uC81C \uC911 \uC624\uB958: ${e}`),e}})}static \u0275fac=function(t){return new(t||l)};static \u0275prov=m({token:l,factory:l.\u0275fac,providedIn:"root"})};export{y as a,$ as b};
